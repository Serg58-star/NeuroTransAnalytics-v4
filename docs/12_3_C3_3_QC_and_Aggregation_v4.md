# C3.3 — Контроль качества и агрегирование данных  
(QC & Aggregation v4)

## 1. Назначение документа

Настоящий документ описывает слой **C3.3** архитектуры NeuroTransAnalytics v4,
предназначенный для:

- формализованного контроля качества данных (QC);
- допустимого агрегирования компонент и реакций;
- подготовки данных к сценарным вычислениям (C3.4).

C3.3 является **обязательным вычислительным слоем**,
расположенным между компонентными расчётами (C3.2)
и сценарным анализом.

---

## 2. Методологическая позиция C3.3

Слой C3.3:

- не интерпретирует данные;
- не вводит новых метрик;
- не изменяет первичные и компонентные значения;
- выполняет **структурный и качественный контроль**.

QC и агрегирование рассматриваются
как **технические операции сопровождения данных**,
а не как исследовательские выводы.

---

## 3. Входные данные слоя C3.3

Входом для C3.3 являются:

- события и реакции из C3.1;
- компонентные значения ΔV1, ΔV4, ΔV5/MT из C3.2;
- параметры дизайна теста (PSI, позиция, цвет, структура).

Все входные данные
происходят **исключительно из `neuro_data.db`**
через слой C3.1.

---

## 4. Контроль качества данных (QC)

### 4.1 Общий принцип QC

Контроль качества в v4 строится по принципу:

> **данные не удаляются, а классифицируются по степени допустимости**.

QC не является фильтром,
а является **механизмом маркировки**.

---

### 4.2 Уровни контроля качества

QC выполняется на трёх уровнях.

#### 4.2.1 Событийный QC

Проверяется:

- наличие RT;
- корректность временных значений;
- соответствие формата данных;
- наличие обязательных параметров стимула.

Результат:
- событие помечается как валидное / невалидное;
- причина невалидности сохраняется явно.

---

#### 4.2.2 Компонентный QC

Проверяется:

- корректность расчёта ΔV1, ΔV4, ΔV5/MT;
- логическая согласованность (ΔV* ≤ RT);
- допустимость значений по диапазонам.

Компонентный QC
**не пересчитывает компоненты**.

---

#### 4.2.3 Контекстный QC

Проверяется:

- согласованность PSI и позиции;
- соответствие параметров метаданным теста;
- корректность сегмента теста.

Контекстный QC используется
для сценариев уровней A и B.

---

## 5. Политика обработки невалидных данных

В версии v4:

- невалидные данные **не удаляются автоматически**;
- они могут:
  - исключаться из конкретного сценария,
  - использоваться в отдельных анализах устойчивости;
- решение всегда принимается **на уровне сценария**, а не QC.

QC формирует только статус,
а не аналитическое решение.

---

## 6. Агрегирование данных

### 6.1 Методологический статус агрегирования

Агрегирование в v4:

- является отдельным вычислительным слоем;
- не подменяет событийные данные;
- не считается «результатом анализа».

Агрегаты служат:
- для устойчивых оценок;
- для сравнения конфигураций;
- для визуализации.

---

### 6.2 Допустимые виды агрегатов

В v4 допускаются следующие типы агрегатов:

- центральные тенденции:
  - медиана,
  - среднее (ограниченно);
- вариабельность:
  - SD,
  - MAD,
  - IQR;
- архитектурные разности:
  - ΔV5/MT − ΔV4;
- сегментарные агрегаты:
  - по позиции,
  - по PSI,
  - по фазе теста.

Агрегирование всегда выполняется
с явным указанием области действия.

---

### 6.3 Ограничения агрегирования

Запрещено:

- агрегировать данные без указания QC-статуса;
- смешивать данные разных тестов без сценарного основания;
- использовать агрегаты как замену событийных данных;
- выполнять скрытое агрегирование на уровне визуализации.

---

## 7. Сегментация теста

Сегментация используется как
инструмент агрегирования и QC.

Возможные сегменты:

- ранний;
- средний;
- поздний;
- пользовательские сценарные сегменты.

Сегментация:
- не изменяет данные;
- используется только как аналитическая ось.

---

## 8. Хранение результатов QC и агрегирования

Результаты C3.3:

- хранятся как отдельный вычислительный слой;
- не модифицируют `neuro_data.db`;
- сопровождаются метаданными:
  - версия QC,
  - правила агрегации,
  - область действия.

Каждый агрегат
обязан быть трассируемым
до исходных событий.

---

## 9. Связь с сценарным анализом

Слой C3.3:

- подготавливает данные для C3.4;
- не знает о конкретных сценариях;
- обеспечивает единый стандарт качества
  для всех сценариев A, B и C.

Сценарий **не может обходить C3.3**.

---

## 10. Итоговая роль C3.3

Слой C3.3 обеспечивает:

- методологически корректный контроль качества;
- воспроизводимое агрегирование;
- защиту от скрытой редукции данных;
- единый стандарт допустимости анализа.

C3.3 является
**обязательным связующим слоем**
между вычислением компонент
и сценарной аналитикой NeuroTransAnalytics v4.

---
