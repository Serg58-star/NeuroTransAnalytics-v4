# NeuroTransAnalytics_Combined_Documentation_Сценарии_уровня_C2_C4_Tom_6

## Оглавление

1. [11_0_C2_Data_Architecture_v4_Map.md](#doc-1-11_0_c2_data_architecture_v4_map)
   - [Уровень C2 — Архитектура данных и хранения (Data Architecture v4)](#уровень-c2-архитектура-данных-и-хранения-data-architecture-v4)
      - [1. Назначение уровня C2](#1-назначение-уровня-c2)
      - [2. Методологические принципы архитектуры v4](#2-методологические-принципы-архитектуры-v4)
         - [2.1. Принцип сценарной адресуемости](#21-принцип-сценарной-адресуемости)
         - [2.2. Принцип нерушимости первичных данных](#22-принцип-нерушимости-первичных-данных)
         - [2.3. Принцип многослойности](#23-принцип-многослойности)
      - [3. Основные сущности данных (Conceptual Entities)](#3-основные-сущности-данных-conceptual-entities)
         - [3.1. Subject (Испытуемый)](#31-subject-испытуемый)
         - [3.2. TestSession (Сеанс тестирования)](#32-testsession-сеанс-тестирования)
         - [3.3. StimulusEvent (Событие стимула)](#33-stimulusevent-событие-стимула)
         - [3.4. ResponseEvent (Событие реакции)](#34-responseevent-событие-реакции)
      - [4. Производные сущности (Derived Entities)](#4-производные-сущности-derived-entities)
         - [4.1. ComponentTiming](#41-componenttiming)
         - [4.2. AggregateMetrics](#42-aggregatemetrics)
      - [5. Сценарный слой (Scenario Layer)](#5-сценарный-слой-scenario-layer)
      - [6. Метаданные и версии](#6-метаданные-и-версии)
      - [7. Поддержка визуализации](#7-поддержка-визуализации)
      - [8. Технические ограничения и реализация](#8-технические-ограничения-и-реализация)
      - [9. Связь с другими уровнями](#9-связь-с-другими-уровнями)
      - [10. Следующий шаг](#10-следующий-шаг)

2. [11_1_C2_1_Data_Model_v4.md](#doc-2-11_1_c2_1_data_model_v4)
   - [C2.1 — Логическая модель данных (Data Model v4)](#c21-логическая-модель-данных-data-model-v4)
      - [1. Назначение документа](#1-назначение-документа)
      - [2. Общие принципы логической модели](#2-общие-принципы-логической-модели)
         - [2.1. Принцип событийной первичности](#21-принцип-событийной-первичности)
         - [2.2. Принцип раздельности дизайна и реакции](#22-принцип-раздельности-дизайна-и-реакции)
         - [2.3. Принцип версионности](#23-принцип-версионности)
      - [3. Основные сущности и их атрибуты](#3-основные-сущности-и-их-атрибуты)
         - [3.1. Subject](#31-subject)
         - [3.2. TestSession](#32-testsession)
         - [3.3. StimulusEvent](#33-stimulusevent)
         - [3.4. ResponseEvent](#34-responseevent)
      - [4. Производные сущности](#4-производные-сущности)
         - [4.1. ComponentTiming](#41-componenttiming)
         - [4.2. AggregateMetrics](#42-aggregatemetrics)
      - [5. Сущности дизайна теста](#5-сущности-дизайна-теста)
         - [5.1. TestConfig](#51-testconfig)
         - [5.2. BackgroundConfig](#52-backgroundconfig)
         - [5.3. MaskingPattern](#53-maskingpattern)
      - [6. Сценарный слой](#6-сценарный-слой)
         - [6.1. ScenarioDefinition](#61-scenariodefinition)
         - [6.2. ScenarioResult](#62-scenarioresult)
      - [7. Связи между сущностями (высокоуровнево)](#7-связи-между-сущностями-высокоуровнево)
      - [8. Поддержка расширяемости](#8-поддержка-расширяемости)
      - [9. Итоговая роль модели](#9-итоговая-роль-модели)

3. [11_2_C2_2_Physical_Storage_Design.md](#doc-3-11_2_c2_2_physical_storage_design)
   - [C2.2 — Физическая реализация хранения данных (Physical Storage Design v4)](#c22-физическая-реализация-хранения-данных-physical-storage-design-v4)
      - [1. Назначение документа](#1-назначение-документа)
      - [2. Общая стратегия хранения](#2-общая-стратегия-хранения)
      - [3. Реляционное хранилище (SQLite)](#3-реляционное-хранилище-sqlite)
         - [3.1. Назначение](#31-назначение)
         - [3.2. Основные таблицы](#32-основные-таблицы)
         - [3.3. Таблицы дизайна](#33-таблицы-дизайна)
      - [4. Хранение производных данных](#4-хранение-производных-данных)
         - [4.1. ComponentTiming (Parquet)](#41-componenttiming-parquet)
         - [4.2. AggregateMetrics (Parquet)](#42-aggregatemetrics-parquet)
      - [5. Сценарный слой хранения](#5-сценарный-слой-хранения)
         - [5.1. Структура каталогов](#51-структура-каталогов)
         - [5.2. Сценарные результаты](#52-сценарные-результаты)
      - [6. Версионность и воспроизводимость](#6-версионность-и-воспроизводимость)
      - [7. Производительность и масштабирование](#7-производительность-и-масштабирование)
      - [8. Резервное копирование и переносимость](#8-резервное-копирование-и-переносимость)
      - [9. Итоговая роль документа](#9-итоговая-роль-документа)

4. [12_0_Карта_уровня_C3_Computation_&_Pipelines_v4.md](#doc-4-12_0_карта_уровня_c3_computation__pipelines_v4)

5. [12_1_C3_1_ETL_Pipeline_v4.md](#doc-5-12_1_c3_1_etl_pipeline_v4)
   - [C3.1 — ETL‑пайплайн для модели данных v4](#c31-etlпайплайн-для-модели-данных-v4)
      - [1. Назначение документа](#1-назначение-документа)
      - [2. Источники данных (Extract)](#2-источники-данных-extract)
         - [2.1. Типы источников](#21-типы-источников)
         - [2.2. Минимальный состав извлекаемых данных](#22-минимальный-состав-извлекаемых-данных)
      - [3. Первичная нормализация (Transform — этап 1)](#3-первичная-нормализация-transform-этап-1)
         - [3.1. Временная нормализация](#31-временная-нормализация)
         - [3.2. Нормализация идентификаторов](#32-нормализация-идентификаторов)
      - [4. Формирование событийного слоя (Transform — этап 2)](#4-формирование-событийного-слоя-transform-этап-2)
         - [4.1. Формирование TestSession](#41-формирование-testsession)
         - [4.2. Формирование StimulusEvent](#42-формирование-stimulusevent)
         - [4.3. Формирование ResponseEvent](#43-формирование-responseevent)
      - [5. Восстановление PSI (Transform — этап 3)](#5-восстановление-psi-transform-этап-3)
      - [6. Контроль качества ETL (QC)](#6-контроль-качества-etl-qc)
      - [7. Загрузка данных (Load)](#7-загрузка-данных-load)
         - [7.1. Загрузка в SQLite](#71-загрузка-в-sqlite)
         - [7.2. Версионность ETL](#72-версионность-etl)
      - [8. Результаты ETL](#8-результаты-etl)
      - [9. Ограничения и предостережения](#9-ограничения-и-предостережения)
      - [10. Итоговая роль документа](#10-итоговая-роль-документа)

6. [12_2_C3_2_Component_Timing_Computation_v4.md](#doc-6-12_2_c3_2_component_timing_computation_v4)
   - [C3.2 — Расчёт компонент временной архитектуры реакции (Component Timing Computation v4)](#c32-расчёт-компонент-временной-архитектуры-реакции-component-timing-computation-v4)
      - [1. Назначение документа](#1-назначение-документа)
      - [2. Общие вычислительные принципы](#2-общие-вычислительные-принципы)
         - [2.1. Принцип компонентной декомпозиции](#21-принцип-компонентной-декомпозиции)
         - [2.2. Принцип независимости от сценария](#22-принцип-независимости-от-сценария)
         - [2.3. Принцип версионности алгоритмов](#23-принцип-версионности-алгоритмов)
      - [3. Расчёт базовой компоненты ΔV1](#3-расчёт-базовой-компоненты-δv1)
         - [3.1. Назначение ΔV1](#31-назначение-δv1)
         - [3.2. Исторический алгоритм расчёта](#32-исторический-алгоритм-расчёта)
      - [4. Расчёт производной компоненты ΔV4](#4-расчёт-производной-компоненты-δv4)
         - [4.1. Логика расчёта](#41-логика-расчёта)
         - [4.2. Условия корректности](#42-условия-корректности)
      - [5. Расчёт производной компоненты ΔV5/MT](#5-расчёт-производной-компоненты-δv5mt)
         - [5.1. Логика расчёта](#51-логика-расчёта)
         - [5.2. Особенности расчёта](#52-особенности-расчёта)
      - [6. Контроль качества компонентных расчётов](#6-контроль-качества-компонентных-расчётов)
      - [7. Хранение результатов](#7-хранение-результатов)
      - [8. Связь с последующими уровнями](#8-связь-с-последующими-уровнями)
      - [9. Ограничения и предостережения](#9-ограничения-и-предостережения)
      - [10. Итоговая роль документа](#10-итоговая-роль-документа)

7. [12_3_C3_3_QC_and_Aggregation_v4.md](#doc-7-12_3_c3_3_qc_and_aggregation_v4)
   - [C3.3 — Контроль качества и агрегирование данных (QC & Aggregation v4)](#c33-контроль-качества-и-агрегирование-данных-qc-aggregation-v4)
      - [1. Назначение документа](#1-назначение-документа)
      - [2. Методологическая позиция QC](#2-методологическая-позиция-qc)
      - [3. Уровни контроля качества](#3-уровни-контроля-качества)
         - [3.1. Событийный QC](#31-событийный-qc)
         - [3.2. Компонентный QC (ΔV*)](#32-компонентный-qc-δv)
      - [4. Принципы агрегирования](#4-принципы-агрегирования)
         - [4.1. Агрегация как отдельный вычислительный слой](#41-агрегация-как-отдельный-вычислительный-слой)
         - [4.2. Допустимые виды агрегатов](#42-допустимые-виды-агрегатов)
         - [4.3. Ограничения агрегирования](#43-ограничения-агрегирования)
      - [5. Исторические и устойчивые метрики](#5-исторические-и-устойчивые-метрики)
      - [6. Сегментация теста](#6-сегментация-теста)
      - [7. Хранение агрегатов и QC-метаданных](#7-хранение-агрегатов-и-qc-метаданных)
      - [8. Связь с сценарным анализом](#8-связь-с-сценарным-анализом)
      - [9. Итоговая роль документа](#9-итоговая-роль-документа)

8. [12_4_C3_4_Scenario_Computation_v4.md](#doc-8-12_4_c3_4_scenario_computation_v4)
   - [C3.4 — Scenario Computation v4](#c34-scenario-computation-v4)
      - [Сценарные вычисления в архитектуре NeuroTransAnalytics v4](#сценарные-вычисления-в-архитектуре-neurotransanalytics-v4)
      - [1. Назначение и место C3.4 в архитектуре v4](#1-назначение-и-место-c34-в-архитектуре-v4)
      - [2. Архитектурный принцип C3.4](#2-архитектурный-принцип-c34)
      - [3. Контракт входных данных](#3-контракт-входных-данных)
         - [3.1. Event-level данные (из C2 / C3.1)](#31-event-level-данные-из-c2-c31)
         - [3.2. Component-level данные (из C3.2)](#32-component-level-данные-из-c32)
         - [3.3. QC-данные (из C3.3)](#33-qc-данные-из-c33)
      - [4. Принципиальные ограничения C3.4](#4-принципиальные-ограничения-c34)
      - [5. Универсальный сценарный вычислительный пайплайн](#5-универсальный-сценарный-вычислительный-пайплайн)
      - [6. Стандартный набор метрик](#6-стандартный-набор-метрик)
         - [6.1. Базовые метрики (для ΔV1, ΔV4, ΔV5MT, RT)](#61-базовые-метрики-для-δv1-δv4-δv5mt-rt)
         - [6.2. Метрики перераспределения времени (A2)](#62-метрики-перераспределения-времени-a2)
         - [6.3. Латерализационные метрики](#63-латерализационные-метрики)
      - [7. Правило интерпретируемости контрастов](#7-правило-интерпретируемости-контрастов)

9. [12_5_C3_5_Visualization_v4.md](#doc-9-12_5_c3_5_visualization_v4)
   - [C3.5 — Visualization v4](#c35-visualization-v4)
      - [Визуализация результатов сценарных вычислений](#визуализация-результатов-сценарных-вычислений)
      - [(NeuroTransAnalytics v4)](#neurotransanalytics-v4)
      - [1. Назначение C3.5 в архитектуре v4](#1-назначение-c35-в-архитектуре-v4)
      - [2. Принципиальные запреты C3.5](#2-принципиальные-запреты-c35)
      - [3. Входной контракт C3.5](#3-входной-контракт-c35)
      - [4. Роль визуализации в проекте NeuroTransAnalytics](#4-роль-визуализации-в-проекте-neurotransanalytics)
      - [5. Базовые типы визуальных артефактов](#5-базовые-типы-визуальных-артефактов)
         - [5.1. Распределения компонент (Distribution Views)](#51-распределения-компонент-distribution-views)
         - [5.2. Архитектурные конфигурации (Architecture Maps)](#52-архитектурные-конфигурации-architecture-maps)
         - [5.3. Контрастные представления (Contrast Views)](#53-контрастные-представления-contrast-views)
         - [5.4. PSI-ориентированные визуализации](#54-psi-ориентированные-визуализации)
      - [6. Латерализация и пространственная организация](#6-латерализация-и-пространственная-организация)
      - [7. Отображение QC и границ применимости](#7-отображение-qc-и-границ-применимости)
      - [8. Универсальный визуализационный пайплайн](#8-универсальный-визуализационный-пайплайн)
      - [9. Форматы выходных артефактов](#9-форматы-выходных-артефактов)
      - [10. Минимальный набор визуализаций для v4](#10-минимальный-набор-визуализаций-для-v4)
      - [11. Методологическое резюме](#11-методологическое-резюме)

10. [13_C4_Interpretation_and_Reporting_v4.md](#doc-10-13_c4_interpretation_and_reporting_v4)
   - [C4 — Interpretation & Reporting v4](#c4-interpretation-reporting-v4)
      - [Интерпретация и отчётность](#интерпретация-и-отчётность)
      - [(NeuroTransAnalytics v4)](#neurotransanalytics-v4)
      - [1. Назначение уровня C4](#1-назначение-уровня-c4)
      - [2. Принципиальная роль интерпретации в v4](#2-принципиальная-роль-интерпретации-в-v4)
      - [3. Ключевое методологическое правило C4](#3-ключевое-методологическое-правило-c4)
      - [3.1. Типы интерпретации в архитектуре v4](#31-типы-интерпретации-в-архитектуре-v4)
         - [3.1.1. Описательная интерпретация (Descriptive Interpretation)](#311-описательная-интерпретация-descriptive-interpretation)
         - [3.1.2. Гипотетическая интерпретация (Hypothetical Interpretation)](#312-гипотетическая-интерпретация-hypothetical-interpretation)
         - [3.1.3. Интерпретация как вывод (Inferential Interpretation)](#313-интерпретация-как-вывод-inferential-interpretation)
      - [4. Входной контракт C4](#4-входной-контракт-c4)
      - [5. Типы допустимой интерпретации](#5-типы-допустимой-интерпретации)
         - [5.1. Архитектурная интерпретация (базовая)](#51-архитектурная-интерпретация-базовая)
         - [5.2. Условно-зависимая интерпретация](#52-условно-зависимая-интерпретация)
         - [5.3. Популяционная интерпретация](#53-популяционная-интерпретация)
      - [6. Интерпретация перераспределения времени (A2)](#6-интерпретация-перераспределения-времени-a2)
      - [7. PSI-зависимая интерпретация (B1)](#7-psi-зависимая-интерпретация-b1)
      - [8. Латерализация и пространственная интерпретация](#8-латерализация-и-пространственная-интерпретация)
      - [9. Структура интерпретационного отчёта](#9-структура-интерпретационного-отчёта)
         - [9.1. Контекст](#91-контекст)
         - [9.2. Наблюдаемые эффекты](#92-наблюдаемые-эффекты)
         - [9.3. Допустимая интерпретация](#93-допустимая-интерпретация)
         - [9.4. Недопустимые выводы (явно)](#94-недопустимые-выводы-явно)
         - [9.5. Инженерные следствия](#95-инженерные-следствия)
      - [10. Типы отчётных документов v4](#10-типы-отчётных-документов-v4)
      - [11. Контроль интерпретационных ошибок](#11-контроль-интерпретационных-ошибок)
      - [12. Методологическое резюме уровня C4](#12-методологическое-резюме-уровня-c4)


---

<!-- ================================================== -->
<!-- source: 11_0_C2_Data_Architecture_v4_Map.md -->
<!-- ================================================== -->
<a id="doc-1-11_0_c2_data_architecture_v4_map"></a>

# Уровень C2 — Архитектура данных и хранения (Data Architecture v4)

## 1. Назначение уровня C2

Уровень **C2** описывает **архитектуру хранения, структурирования и доступа к данным** 
проекта *NeuroTransAnalytics* версии v4.

Его задача — обеспечить:

* сохранение всей многомерности данных без редукции;
* воспроизводимость сценариев анализа A0–B3;
* прямую поддержку методических рекомендаций уровня C1;
* расширяемость под будущие тесты и нагрузки.

Уровень C2 **не вводит новых аналитических интерпретаций** и не изменяет методологию анализа —
он фиксирует, *как данные должны храниться, чтобы всё уже спроектированное было реализуемо*.

---

## 2. Методологические принципы архитектуры v4

### 2.1. Принцип сценарной адресуемости

Каждый результат в базе данных должен быть:

* однозначно связан со сценарием (A0.x, A1.x, A2.x, Bx, Cx);
* воспроизводим без скрытых агрегатов;
* трассируем до исходных событий теста.

---

### 2.2. Принцип нерушимости первичных данных

* сырые данные тестов **никогда не переписываются**;
* любые производные показатели существуют как отдельные сущности;
* допускается хранение нескольких версий производных расчётов.

---

### 2.3. Принцип многослойности

Архитектура данных строится слоями:

* события →
* агрегаты →
* сценарные представления →
* визуализации.

Каждый слой изолирован и явно описан.

---

## 3. Основные сущности данных (Conceptual Entities)

### 3.1. Subject (Испытуемый)

Минимальный набор:

* анонимный идентификатор;
* пол;
* возраст (или возрастная группа);
* дополнительные демографические признаки (опционально).

---

### 3.2. TestSession (Сеанс тестирования)

Описывает:

* дату и время;
* тип теста;
* фазу (Ф₁ / Ф₂ / Ф₃);
* версию конфигурации теста.

---

### 3.3. StimulusEvent (Событие стимула)

Ключевая сущность уровня v4.

Содержит:

* тип стимула (тестовый / маскирующий / промежуточный);
* цвет стимула;
* пространственную локализацию;
* позицию в последовательности;
* PSI_test / PSI_mask / PSI_transition;
* параметры фона;
* идентификатор маскирующей конфигурации.

---

### 3.4. ResponseEvent (Событие реакции)

Содержит:

* время реакции (RT);
* флаги валидности;
* информацию об ошибках и пропусках.

---

## 4. Производные сущности (Derived Entities)

### 4.1. ComponentTiming

Хранит:

* ΔV1;
* ΔV4;
* ΔV5/MT;
* версию алгоритма расчёта;
* параметры фильтрации (MAD и др.).

---

### 4.2. AggregateMetrics

Содержит:

* медианы;
* вариабельность;
* архитектурные разности;
* сегментарные показатели.

Агрегаты **никогда не заменяют** первичные данные.

---

## 5. Сценарный слой (Scenario Layer)

Для каждого сценария:

* хранится список используемых сущностей;
* фиксируется версия сценария;
* сохраняются промежуточные результаты;
* обеспечивается повторяемость расчёта.

---

## 6. Метаданные и версии

Архитектура v4 требует явного хранения:

* версий тестовых конфигураций;
* версий сценариев анализа;
* версий алгоритмов расчёта.

Никакие изменения не происходят «молча».

---

## 7. Поддержка визуализации

Архитектура данных должна:

* поддерживать выборки по любым осям (цвет, PSI, позиция, канал);
* обеспечивать быстрый доступ к временным профилям;
* позволять интерактивную навигацию без перерасчёта данных.

---

## 8. Технические ограничения и реализация

Архитектура v4:

* реализуема на персональном компьютере;
* совместима с Python 3;
* допускает хранение в SQLite / Parquet / HDF5;
* не требует серверной инфраструктуры.

---

## 9. Связь с другими уровнями

* опирается на A0–B3 (что анализируется);
* реализует C1 (как проектировать);
* подготавливает C3 (как считать);
* подготавливает C4 (как визуализировать).

---

## 10. Следующий шаг

После утверждения карты C2 логично:

1. детализировать **C2.1 — логическую модель данных**;
2. затем **C2.2 — физическую реализацию хранения**;
3. и только после этого переходить к C3.

