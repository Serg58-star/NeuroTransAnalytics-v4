<!-- ================================================== -->
<!-- source: 12_4_C3_4_Scenario_Computation_v4.md -->
<!-- ================================================== -->
<a id="doc-8-12_4_c3_4_scenario_computation_v4"></a>

# C3.4 — Scenario Computation v4  
## Сценарные вычисления в архитектуре NeuroTransAnalytics v4

---

## 1. Назначение и место C3.4 в архитектуре v4

Подуровень **C3.4 (Scenario Computation)** является вычислительным слоем,
который реализует **формальные исследовательские сценарии** проекта *NeuroTransAnalytics v4*
на основе:

- компонент временной архитектуры, рассчитанных в **C3.2**;
- результатов контроля качества и допустимости, зафиксированных в **C3.3**.

C3.4 является **переходным слоем** между:
- инфраструктурно-вычислительным уровнем (C3.1–C3.3),
- и аналитико-интерпретационными уровнями (C3.5 — визуализация, C4 — интерпретация и отчётность).

C3.4 **не занимается**:
- очисткой данных;
- пересчётом компонент;
- физиологической интерпретацией;
- визуализацией.

Его задача — **строго воспроизводимое сценарное вычисление**.

---

## 2. Архитектурный принцип C3.4

В архитектуре v4 **каждый сценарий** (A0–A2, B1–B3) трактуется как:

> формализованный запрос к временной архитектуре зрительной реакции  
> при фиксированных правилах допустимости и агрегирования.

Сценарий в C3.4 — это **не код**, а **спецификация вычисления**,
которая может быть реализована любым техническим способом,
но обязана давать воспроизводимый результат.

---

## 3. Контракт входных данных

### 3.1. Event-level данные (из C2 / C3.1)

Используются для:
- реконструкции условий,
- группировки,
- проверки сценарных ограничений.

Минимальный состав:
- `StimulusEvent`
- `ResponseEvent`
- `trial_id`
- `session_id`
- `subject_id`
- `test_id`
- `block_id`
- `position_in_sequence`
- `color`
- `visual_field` (left / center / right)
- `PSI_type` (test / mask / transition)
- `PSI_value`
- `masking_type`
- дополнительные метаданные дизайна

---

### 3.2. Component-level данные (из C3.2)

Единица анализа — **trial**.

Обязательные поля:
- `RT_total`
- `ΔV1`
- `ΔV4`
- `ΔV5MT`
- `component_algo_version`

---

### 3.3. QC-данные (из C3.3)

QC используется как **фильтр применимости**, а не как инструмент очистки.

Обязательные поля:
- `qc_pass` (boolean)
- `qc_flags` (мульти-метки)
- дополнительные QC-индикаторы (преждевременное нажатие, пропуск и т.п.)

---

## 4. Принципиальные ограничения C3.4

C3.4 **запрещено**:

1. Удалять или модифицировать данные.
2. Игнорировать QC-флаги.
3. Вводить новые временные компоненты.
4. Использовать нефомализованные метрики (например, «стабилизация», «нелинейность»).
5. Интерпретировать результаты физиологически или психологически.

---

## 5. Универсальный сценарный вычислительный пайплайн

Каждый сценарий в C3.4 обязан реализовываться через один и тот же логический конвейер:

1. **Select**  
   Отбор данных по условиям сценария.

2. **QC Gate**  
   Применение правила допустимости:
   - `strict` (только qc_pass),
   - `soft` (qc_pass + отмеченные флаги),
   - `flagged_only` (для исследовательских целей).

3. **Group**  
   Формирование групп по сценарным ключам  
   (например: `color × visual_field × PSI_type`).

4. **Aggregate**  
   Расчёт устойчивых метрик компонент и RT.

5. **Contrast**  
   Формирование разностей и subtraction-структур между условиями.

6. **Significance**  
   Непараметрическая оценка значимости эффектов.

7. **Emit**  
   Формирование стандартного выходного артефакта.

---

## 6. Стандартный набор метрик

### 6.1. Базовые метрики (для ΔV1, ΔV4, ΔV5MT, RT)

Допустимы **только устойчивые описатели**:

- медиана
- MAD (или MAD-based scale)
- IQR
- p10 / p90
- доля значений за QC-границами

---

### 6.2. Метрики перераспределения времени (A2)

Используются как **координаты архитектуры**, а не как объяснение:

- `share_V1 = ΔV1 / RT_total`
- `share_V4 = ΔV4 / RT_total`
- `share_V5MT = ΔV5MT / RT_total`

Анализируются:
- абсолютные значения,
- контрасты между условиями,
- популяционные распределения конфигураций.

---

### 6.3. Латерализационные метрики

- `(left − right)` по компонентам и RT
- `(center − periphery)` при наличии центральных стимулов

---

## 7. Правило интерпретируемости контрастов

Каждый контраст обязан иметь **два уровня представления**:

1. **RawContrast**  
   Числовая разность без интерпретации.

2. **InterpretableContrast**  
   Контраст с флагом допустимости интерпретации:

```text
is_interpretable = True / False

Интерпретация запрещена, если эффект статистически не подтверждён.

8. Стандартная структура результата сценария
8.1. ScenarioResult

Обязательные поля:

scenario_id

analysis_unit (trial / session / subject / cohort)

group_keys

metrics

effect_estimates

significance

qc_summary

component_algo_version

scenario_version

8.2. DistributionPack

перцентили

устойчивые меры разброса

формы распределений без предположений о нормальности

8.3. ContrastPack

subtraction-эффекты

интервалы неопределённости

флаги интерпретируемости

9. PSI как инструмент вскрытия архитектуры

В C3.4 PSI трактуется как архитектурный зонд, а не просто условие.

Используются три типа:

PSI_test

PSI_mask

PSI_transition

Допустимы:

прямые сравнения PSI-режимов;

взаимодействия PSI × color × visual_field;

анализ PSI-зависимого перераспределения компонент.

10. Минимальный набор сценариев для первичной реализации C3.4

Рекомендуемый стартовый пакет:

A0.1 — ΔV1 Variability

A0.3 — Architectural Symmetry

A1.0 — Architecture Divergence (ΔV4 vs ΔV5MT)

A2.0 — Temporal Reallocation

B1 — PSI as Architecture Probe

Данный набор покрывает:

базовые метрики,

subtraction-логику,

PSI-зависимые эффекты,

популяционный анализ.

11. Версионность и воспроизводимость

Каждый результат C3.4 обязан явно фиксировать:

версию сценария;

версию алгоритма расчёта компонент;

дату вычисления;

параметры QC-gate;

используемый набор метрик.

Без этих данных результат считается невалидным для дальнейшей интерпретации.

12. Методологическое резюме

C3.4 обеспечивает:

строгую формализацию сценариев;

воспроизводимость вычислений;

защиту от неявных допущений;

готовность данных к визуализации и интерпретации.

C3.4 не отвечает на вопрос «почему»,
но делает возможным корректный переход к этому вопросу на уровне C4.


---

---

<!-- ================================================== -->
<!-- source: 12_5_C3_5_Visualization_v4.md -->
<!-- ================================================== -->
<a id="doc-9-12_5_c3_5_visualization_v4"></a>

# C3.5 — Visualization v4  
## Визуализация результатов сценарных вычислений  
## (NeuroTransAnalytics v4)

---

## 1. Назначение C3.5 в архитектуре v4

Подуровень **C3.5 (Visualization)** предназначен для **визуального представления**
артефактов, сформированных на уровне **C3.4_Scenario_Computation_v4**.

C3.5 является:

- строго **отображающим** слоем;
- методически нейтральным;
- лишённым вычислительной и интерпретационной логики.

C3.5 обеспечивает **читаемость архитектуры данных и эффектов**,  
но **не делает выводов** и **не трансформирует результаты**.

---

## 2. Принципиальные запреты C3.5

C3.5 **категорически запрещено**:

1. Выполнять любые вычисления (включая агрегацию).
2. Фильтровать данные помимо уже зафиксированного QC-gate.
3. Изменять масштабы, скрывающие реальные распределения.
4. Нормализовать данные «для красоты».
5. Использовать визуальные метафоры, предполагающие интерпретацию
   (например, «оптимум», «норма», «деградация»).

C3.5 **не отвечает** на вопрос *почему* и даже *что это значит* —  
только *как это выглядит*.

---

## 3. Входной контракт C3.5

C3.5 принимает **исключительно стандартизированные артефакты C3.4**:

- `ScenarioResult`
- `DistributionPack`
- `ContrastPack`

Любые визуализации, не имеющие прямого соответствия этим структурам,
считаются **архитектурным нарушением**.

---

## 4. Роль визуализации в проекте NeuroTransAnalytics

В рамках v4 визуализация выполняет **три инженерные функции**:

1. **Экспликация структуры**  
   Делает видимой конфигурацию временной архитектуры реакции.

2. **Обнаружение режимов и границ применимости**  
   Позволяет увидеть:
   - плотность краёв распределений;
   - зоны QC-напряжения;
   - популяционные кластеры.

3. **Подготовка к интерпретации (C4)**  
   Формирует визуальный контекст,
   в котором допустима дальнейшая аналитическая работа.

---

## 5. Базовые типы визуальных артефактов

### 5.1. Распределения компонент (Distribution Views)

Используются для:
- ΔV1
- ΔV4
- ΔV5MT
- RT_total
- долей вкладов (share_V*)

Допустимые формы:
- boxplot (с медианой, IQR, выбросы — как факт, не как ошибка)
- violin / half-violin (без сглаживания, искажающего хвосты)
- empirical CDF (по необходимости)

Запрещено:
- усреднение без отображения разброса;
- визуальное «сжатие» хвостов.

---

### 5.2. Архитектурные конфигурации (Architecture Maps)

Цель — показать **соотношение компонент**, а не абсолютные значения.

Формы:
- stacked bars (доли вкладов ΔV1 / ΔV4 / ΔV5MT)
- ternary-подобные проекции (если реализуемо без интерпретации)
- параллельные координаты (components × conditions)

Используются исключительно данные `share_*` из C3.4.

---

### 5.3. Контрастные представления (Contrast Views)

Используются `ContrastPack`.

Допустимые формы:
- forest plot (эффект + интервал неопределённости)
- paired-difference plot
- signed bar plots (с обязательным указанием нулевой линии)

Обязательное требование:
- **визуально различать**:
  - RawContrast
  - InterpretableContrast (например, насыщенностью или рамкой)

---

### 5.4. PSI-ориентированные визуализации

PSI рассматривается как **ось архитектурного зондирования**.

Формы:
- faceting по `PSI_type`
- линии изменения компонент вдоль PSI
- heatmap взаимодействий `PSI × color × visual_field`
  (только при явной фиксации QC и объёма данных)

Запрещено:
- интерпретировать PSI как «внимание», «ожидание» и т.п.

---

## 6. Латерализация и пространственная организация

Для сценариев A0.3, B2 и смежных:

Допустимые формы:
- зеркальные графики (left vs right)
- центр как отдельная категория, а не «ноль»
- симметричные шкалы

Обязательное требование:
- визуально не навязывать симметрию, если её нет в данных.

---

## 7. Отображение QC и границ применимости

QC в визуализации — **не мусор**, а **информация**.

Допустимые способы:
- подписи доли QC-отфильтрованных trial'ов
- отдельный слой/цвет для flagged данных
- аннотации «low support» при малых n

Запрещено:
- скрывать QC-ограничения;
- визуально «исправлять» проблемные данные.

---

## 8. Универсальный визуализационный пайплайн

Каждая визуализация в C3.5 обязана явно соответствовать схеме:

1. Получен конкретный `ScenarioResult`
2. Выбран тип визуального артефакта
3. Зафиксированы:
   - scenario_id
   - component_algo_version
   - scenario_version
   - QC-gate
4. Визуализация сохранена как воспроизводимый объект

---

## 9. Форматы выходных артефактов

C3.5 допускает следующие форматы:

- статические изображения (PNG / SVG)
- интерактивные панели (если сохраняется воспроизводимость)
- отчётные PDF-фрагменты (как слой над C3.4)

Каждый визуальный артефакт обязан иметь:
- машинно-читаемый идентификатор;
- ссылку на сценарий;
- дату генерации.

---

## 10. Минимальный набор визуализаций для v4

Рекомендуемый стартовый набор:

1. Распределения ΔV1 по условиям (A0.1)
2. Архитектурные доли ΔV1 / ΔV4 / ΔV5MT (A2.0)
3. Контрасты ΔV4 vs ΔV5MT (A1.0)
4. PSI-зависимые профили компонент (B1)
5. Латерализационные карты (A0.3 / B2)

---

## 11. Методологическое резюме

C3.5:

- делает архитектуру реакции **видимой**;
- не подменяет анализ интерпретацией;
- сохраняет все ограничения и допущения явными;
- подготавливает корректный переход к уровню **C4**.

C3.5 — это **окно**, а не **фильтр**.

---
