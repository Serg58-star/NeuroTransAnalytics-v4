# C3.5 — Visualization v4  

(Визуализация результатов сценарных вычислений)

## 1. Назначение слоя C3.5

Слой **C3.5** отвечает за визуальное представление результатов сценарных вычислений в архитектуре NeuroTransAnalytics версии v4.

В версии v4 визуализация является **строго пассивным слоем**:

- она не выполняет вычислений;
- она не агрегирует и не фильтрует первичные данные;
- она отображает только стандартизированные артефакты, полученные из слоя **C3.4**.

Основная задача C3.5 — обеспечить качественное и точное отображение расчетных моделей для последующей интерпретации на уровне C4.

---

## 2. Методологическая позиция визуализации

Визуализация в v4 — это **средство отображения (View)**, а не инструмент анализа.

- Любой визуальный объект (график, гистограмма, карта) имеет смысл только в связке с конкретным идентификатором и версией сценария.
- Визуализация не может порождать новые численные значения, не зафиксированные в выходных артефактах вычислительного ядра.

---

## 3. Входной контракт C3.5

### 3.1 Допустимые источники данных

Слой C3.5 принимает на вход исключительно подготовленные вычислительные пакеты:

- **ScenarioResult**: финальные метрики сценария.
- **DistributionPack**: наборы данных для построения распределений.
- **ContrastPack**: данные для сравнительных (контрастных) визуализаций.

### 3.2 Отсутствие прямого доступа к SQLite

В архитектуре v4 **GUI никогда не обращается к `neuro_data.db` напрямую**. Прямое чтение таблиц `trials`, `users` или `metadata_*` из интерфейса визуализации запрещено. Все необходимые данные для отображения должны быть извлечены и упакованы слоем C3.1–C3.4.

---

## 4. Принцип «GUI не считает»

Для обеспечения архитектурной чистоты и воспроизводимости в C3.5 реализуется принцип отсутствия скрытой логики:

- **Никаких агрегаций в UI**: если на графике отображается среднее или медиана, это значение должно быть рассчитано в C3.3/C3.4.
- **Никаких фильтров в UI**: выбор параметров отображения (например, "показать только женщин") является фильтрацией на уровне отображения уже существующих в артефакте сегментов, а не повторным запросом к базе.
- **Никаких трансформаций**: масштабирование осей допустимо, изменение самих данных — нет.

---

## 5. Основные типы отображаемых данных

### 5.1 Распределения (Distribution Views)

Отображение частотных характеристик RT и компонент ΔV на основе `DistributionPack`. Визуализация должна сохранять форму распределения, рассчитанную алгоритмически.

### 5.2 Архитектурные карты (Architecture Maps)

Визуализация соотношений компонент и профилей перераспределения времени, зафиксированных в ScenarioResult.

### 5.3 Контрасты (Contrast Views)

Графическое представление различий между условиями (например, PSI_short vs PSI_long) на основе `ContrastPack`.

---

## 6. Отображение качества и статуса (QC Flags)

Каждая визуальная форма в C3.5 обязана отображать:

- Статус контроля качества (QC), переданный из C3.3.
- Версию алгоритмов и сценария.
- Информацию о выборке (количество использованных реакций).

Визуализация без указания QC-статуса считается методологически некорректной.

---

## 7. Универсальный процесс визуализации

Процесс отображения в v4 детерминирован:

1. **Выбор артефакта**: Загрузка `ScenarioResult`.
2. **Загрузка данных**: Подгрузка связанных паков (Distribution/Contrast).
3. **Рендеринг**: Отображение данных через фиксированные шаблоны (Templates).
4. **Экспорт**: Сохранение визуального образа с сохранением ссылок на исходные вычисления.

---

## 8. Принципиальные ограничения и запреты

**Запрещено:**

- Рассчитывать любые метрики (среднее, SD, разности) внутри кода визуализации.
- Использовать SQL-запросы в GUI.
- Скрывать данные, помеченные как "невалидные", без явного указания на это.
- Вводить интерпретационные выводы (например, текст "это отклонение от нормы") непосредственно в визуальные компоненты — это задача уровня C4.

---

## 9. Итоговая фиксация

Слой C3.5 является завершающим этапом технического пайплайна архитектуры v4. Он гарантирует, что исследователь видит именно те результаты, которые были получены в ходе механической и воспроизводимой обработки данных, без искажений, внесенных на этапе отображения.
