# Уровень C2 — Архитектура данных и хранения (Data Architecture v4)

## 1. Назначение документа

Настоящий документ фиксирует **карту архитектуры данных уровня C2**
проекта NeuroTransAnalytics версии v4.

В отличие от ранних версий проекта,
в v4 архитектура данных **не проектируется абстрактно**,
а **опирается на уже реализованную и зафиксированную базу данных**.

Единственным источником данных проекта является:

**SQLite база `neuro_data.db`**

---

## 2. Методологическая позиция уровня C2

Уровень C2 отвечает на вопрос:

> *как данные должны быть организованы и сохранены,
> чтобы все сценарии уровней A и B были воспроизводимы
> без потери сложности и без методологической редукции.*

Уровень C2:

- не вводит новых аналитических понятий;
- не пересматривает сценарии анализа;
- не интерпретирует данные;
- фиксирует **инженерную реальность хранения данных v4**.

---

## 3. Ключевой инвариант данных v4

**Инвариант C2.v4:**

> Все первичные данные проекта NeuroTransAnalytics v4
> хранятся в единой реляционной базе SQLite `neuro_data.db`
> и не зависят от внешних файловых источников.

Любые legacy-форматы (xlsx, ini, mdb):

- не участвуют в вычислениях,
- не требуются для воспроизводимости,
- сохраняются исключительно как исторический контекст.

---

## 4. Логические группы данных в `neuro_data.db`

### 4.1 Субъекты (Subjects)

**Таблица:** `users`

Содержит:

- уникальный идентификатор субъекта;
- пол;
- дату рождения;
- дату первого тестирования.

Назначение:

- идентификация субъекта без персональных данных;
- поддержка популяционного и лонгитюдного анализа.

---

### 4.2 Тестовые сессии и реакции (Trials)

**Таблица:** `trials`

Каждая строка таблицы соответствует:

- одной тестовой сессии,
- одного субъекта,
- одному запуску батареи тестов.

Содержит:

- временные метки;
- 36 реакций для каждого теста (Tst1, Tst2, Tst3);
- показатели ошибок и агрегаты,
  сохранённые в историческом виде без пересчёта.

---

### 4.3 Метаданные тестовых стимулов

Метаданные тестовых предъявлений реализованы отдельными таблицами:

- `metadata_simple` — тест простой реакции (Tst1)
- `metadata_color_red` — тест на красный цвет (Tst2)
- `metadata_shift` — тест со сдвигом (Tst3)

Каждая таблица содержит **ровно 36 записей**,
соответствующих фиксированной структуре теста.

Метаданные включают:

- цвет стимула;
- пространственную локализацию;
- предстимульный интервал (PSI);
- параметры маскировки и движения (где применимо).

Метаданные считаются:

- частью дизайна теста;
- неизменяемыми;
- равноправными параметрами сценарного анализа.

---

### 4.4 Разминочные стимулы (Warmup)

Разминочные последовательности представлены таблицами:

- `warmup_simple`
- `warmup_color_red`
- `warmup_shift`

Разминочные стимулы:

- **не являются единицами анализа**;
- не формируют строки датасета;
- участвуют только через формирование PSI и контекста реакции.

---

### 4.5 Системные параметры

**Таблица:** `system_parameters`

Содержит:

- константы экспериментальной установки;
- фиксированную длину тестов;
- технологические параметры предъявления стимулов.

Системные параметры:

- не выводятся из данных;
- не подлежат статистическому анализу;
- используются как ограничения корректности.

---

## 5. Принцип нерушимости первичных данных

В архитектуре v4:

- данные в `neuro_data.db` **не модифицируются**;
- любые производные показатели рассчитываются вне базы
  или сохраняются как версионные результаты;
- база данных является источником истины,
  а не продуктом вычислений.

---

## 6. Связь уровня C2 с другими уровнями

- **A0–A2** используют данные `trials` + `metadata_*`;
- **B1–B3** используют PSI, позицию и структуру теста
  как инструментальные параметры;
- **C3** выполняет вычисления поверх `neuro_data.db`;
- **C4** интерпретирует только результаты сценарных вычислений.

Уровень C2 не содержит логики анализа
и не зависит от визуализации.

---

## 7. Итоговая фиксация

Архитектура данных уровня C2 для версии v4 считается:

- реализованной;
- устойчивой;
- достаточной для всех сценариев проекта;
- закрытой для изменений,
  не нарушающих обратную совместимость с `neuro_data.db`.

Любые дальнейшие расширения проекта
обязаны сохранять данный инвариант.

---
