# Уровень C3 — Вычислительные пайплайны и обработка данных (Computation & Pipelines v4)

## 1. Назначение уровня C3

Уровень C3 описывает:

- как данные переходят от физического хранения в SQLite (C2) к аналитическим результатам сценариев A0–B3;
- строго детерминированную и воспроизводимую последовательность преобразований.

C3 отвечает на вопрос:

- каким образом алгоритмически считаются показатели;
- как гарантируется, что любой результат можно механически пересобрать заново на основе данных из `neuro_data.db`.

C3:

- не вводит новых методик (это C1);
- не вводит новых сущностей данных (это C2);
- реализует **вычислительную дисциплину** проекта как замкнутый алгоритмический цикл.

---

## 2. Принципы вычислительной архитектуры v4

### 2.1. Принцип пошаговой трассируемости

Каждый вычислительный шаг имеет имя, версию, сохраняет результат и указывает на конкретные записи или таблицы в `neuro_data.db`.

### 2.2. Принцип идемпотентности и детерминизма

Повторный запуск пайплайна на тех же входных данных из SQLite всегда даёт идентичный результат. Вычисления полностью отделены от случайных факторов или состояния среды.

### 2.3. Принцип сценарной независимости

Каждый сценарий (A0.x, A1.x, Bx…) исполняется как отдельный вычислительный граф. Сценарии не зависят от порядка запуска и не модифицируют исходную базу данных.

---

## 3. Общая структура C3

C3 организован как каскад пайплайнов:

- **C3.1 ETL** → Извлечение из SQLite и формирование нормализованных событий.
- **C3.2 Расчёт компонент** → Алгоритмическая декомпозиция RT на ΔV1, ΔV4, ΔV5/MT.
- **C3.3 QC и Агрегации** → Детерминированная фильтрация и маркировка качества.
- **C3.4 Сценарные вычисления** → Формирование результатных артефактов по сценариям A и B.
- **C3.5 Визуализационные слои** → Механическое преобразование результатов в графические формы.

---

## 4. C3.1 — ETL в модель v4

**Назначение:**

- извлечь данные из канонических таблиц SQLite (`trials`, `users`, `metadata_*`);
- привести к нормализованной событийной модели;
- зафиксировать трансформации в виде метаданных сессии.

**Ключевые шаги:**

- чтение из `neuro_data.db`;
- нормализация временных меток;
- сопоставление реакций с метаданными PSI из таблиц `metadata_*`;
- формирование унифицированных структур `StimulusEvent` и `ResponseEvent`.

---

## 5. C3.2 — Расчёт компонент времени (ΔV1, ΔV4, ΔV5/MT)

**Назначение:**

- получить компонентную декомпозицию RT через детерминированные алгоритмы;
- сохранить параметры и версии расчётов.

**Особенности:**

- ΔV1 — базовая сенсомоторная компонента;
- ΔV4 / ΔV5/MT — архитектурные производные;
- расчёт является чисто арифметическим и не содержит интерпретации физиологического смысла.

---

## 6. C3.3 — QC и агрегаты

**QC (Quality Control):**

- механическая проверка данных на соответствие диапазонам и логике;
- маркировка записей флагами качества (валидно/невалидно) в SQLite или производных структурах.

**Агрегаты:**

- выполняются только поверх промаркированных данных;
- исключают субъективное суждение о "плохих" данных;
- используют фиксированные алгоритмы (медиана, MAD).

---

## 7. C3.4 — Сценарные вычисления (A и B)

**Структура:**
Каждый сценарий получает входные данные из предыдущих слоёв, применяет фиксированные фильтры и сохраняет результаты в виде неизменяемых вычислительных артефактов.

---

## 8. C3.5 — Визуализационные пайплайны

**Назначение:**

- полностью отделить расчётную часть от графического представления;
- гарантировать, что визуализация является только отображением (view) данных C3.4.

---

## 9. Связь с другими уровнями

- **C1 (Методика):** Определяет алгоритмы, реализуемые в C3.
- **C2 (Данные):** Предоставляет физическое хранилище (`neuro_data.db`) как единственный источник истины.
- **C4 (Интерпретация):** Получает готовые артефакты C3.4 для формирования отчётов и выводов.

---

## 10. Итоговая фиксация

Карта C3 v4 фиксирует переход от файлово-ориентированной обработки к системному пайплайну на базе SQLite. Слой C3 описывает **как** преобразуются данные, полностью исключая вопрос о том, **что** они значат (это прерогатива C4).
