# C2.2 — Физическая реализация хранения данных (Physical Storage Design v4)

## 1. Назначение документа

Документ описывает **физическую реализацию хранения данных** проекта *NeuroTransAnalytics* версии v4
на основе логической модели **C2.1**.

Цель:

* обеспечить реализуемость архитектуры на персональном компьютере (Windows 10);
* сохранить всю полноту данных без редукции;
* обеспечить удобство вычислений, визуализации и расширения проекта.

Документ **не содержит программного кода**, а фиксирует архитектурные решения хранения.

---

## 2. Общая стратегия хранения

Рекомендуется гибридная стратегия:

* **SQLite** — для событийных и реляционных данных;
* **Parquet** — для крупных массивов производных и агрегатов;
* **файловая иерархия** — для сценарных результатов и визуализаций.

---

## 3. Реляционное хранилище (SQLite)

### 3.1. Назначение

SQLite используется для хранения первичных данных проекта. В версии v4 базой данных является `neuro_data.db`.

---

### 3.2. Основные таблицы

В текущей физической реализации v4 логические сущности представлены следующим набором таблиц:

#### users

Физически реализует сущность **Subject**.

* subject_id (PK)
* sex (gender)
* age (birth_date)
* first_test_date

#### trials

Физически представляет сущности **TestSession** и связанные с ними **ResponseEvent**.

* trial_id (PK)
* subject_id (FK)
* test_date, test_time
* session_condition
* tst1_1 … tst3_36 (времена реакций)
* агрегаты ошибок и статистик

#### metadata_* (simple, color_red, shift)

Физически реализуют сущность **StimulusEvent** для зачётных тестов.

* stimulus_id (PK)
* color
* position
* psi_ms
* параметры маскировки и движения

---

### 3.3. Таблицы дизайна и разминки

В v4 параметры дизайна и разминочные последовательности представлены следующими группами таблиц:

#### metadata_*

* `metadata_simple`
* `metadata_color_red`
* `metadata_shift`

#### warmup_*

Физически реализуют сущность **StimulusEvent** для разминочных фаз.

* `warmup_simple`
* `warmup_color_red`
* `warmup_shift`

#### system_parameters

Физически реализует настройки экспериментальной установки.

* param_key (PK)
* param_value

---

## 4. Хранение производных данных

### 4.1. ComponentTiming (Parquet)

Хранится в виде Parquet-файлов (производный слой):

* delta_v1
* delta_v4
* delta_v5_mt
* computation_version
* filtering_params
* stimulus_event_id

---

### 4.2. AggregateMetrics (Parquet)

Хранит:

* агрегаты с указанием области агрегации;
* версии алгоритмов;
* ссылки на исходные события.

---

## 5. Сценарный слой хранения

### 5.1. Структура каталогов

```
data/
  raw/
  sqlite/
    neuro_data.db
  derived/
    component_timing/
    aggregates/
  scenarios/
    A0/
    A1/
    A2/
    B1/
    B2/
    C/
```

---

## 6. Версионность и воспроизводимость

Фиксируется:

* версия базы данных;
* версия логической модели;
* версия сценариев;
* версия расчётных алгоритмов.

---

## 7. Производительность и масштабирование

Архитектура рассчитана на:

* пакетную обработку;
* интерактивный анализ агрегатов.

---

## 8. Резервное копирование и переносимость

Рекомендуется:

* регулярное резервное копирование SQLite;
* хранение Parquet-файлов как неизменяемых артефактов;
* переносимость проекта целиком через файловую структуру.

---

## 9. Итоговая роль документа

Документ C2.2 обеспечивает:

* физическую реализуемость архитектуры v4;
* согласованность с методологией C1;
* основу для реализации вычислительных пайплайнов (C3).

---
