# C3.4 — Scenario Computation v4  
(Сценарные вычисления в архитектуре NeuroTransAnalytics)

## 1. Назначение и место C3.4 в архитектуре v4

Слой **C3.4** реализует сценарные вычисления
в архитектуре NeuroTransAnalytics версии v4.

C3.4 является **центральным вычислительным ядром проекта**,
в котором:

- данные получают сценарный контекст;
- формируются аналитические контрасты;
- создаются стандартизированные вычислительные артефакты.

C3.4 расположен:

C3.1 (ETL)
↓
C3.2 (Component Timing)
↓
C3.3 (QC & Aggregation)
↓
C3.4 (Scenario Computation)
↓
C3.5 (Visualization)
↓
C4 (Interpretation & Reporting)


---

## 2. Методологическая позиция слоя C3.4

C3.4:

- **не интерпретирует** результаты;
- **не визуализирует** данные;
- **не модифицирует** первичные данные;
- **не выполняет физиологических или клинических выводов**.

Назначение C3.4 —
**формально и воспроизводимо реализовать сценарии анализа**,
описанные на уровнях A и B.

---

## 3. Входной контракт C3.4

### 3.1 Источник данных

Все входные данные поступают
**исключительно из слоёв C3.1–C3.3**,
которые, в свою очередь,
работают поверх базы `neuro_data.db`.

C3.4 **не обращается напрямую к базе данных**.

---

### 3.2 Типы входных данных

C3.4 использует:

- событийные данные (StimulusEvent, ResponseEvent);
- компонентные значения (ΔV1, ΔV4, ΔV5/MT);
- QC-статусы;
- агрегаты, сформированные в C3.3;
- параметры дизайна теста (PSI, позиция, цвет, структура).

---

## 4. Принцип сценарной адресуемости

Каждое вычисление в C3.4:

- принадлежит **конкретному сценарию**;
- имеет уникальный сценарный код
  (A0.x, A1.x, A2.x, B1, B2, B3, Cx);
- выполняется в рамках фиксированной версии сценария.

Сценарий является **единицей вычислительного смысла**,
а не просто набором фильтров.

---

## 5. Универсальный сценарный вычислительный пайплайн

Каждый сценарий реализуется
через единый вычислительный шаблон:

1. выбор входных данных;
2. применение QC-ограничений;
3. формирование аналитических осей;
4. расчёт метрик;
5. формирование сценарных артефактов.

Логика пайплайна **унифицирована**
для всех сценариев v4.

---

## 6. Стандартный набор метрик

### 6.1 Базовые метрики

Для всех сценариев доступны:

- медиана RT;
- медиана ΔV1;
- медиана ΔV4;
- медиана ΔV5/MT;
- вариабельность (SD, MAD, IQR);
- асимметрии распределений.

---

### 6.2 Метрики перераспределения времени (A2)

В сценариях уровня A2
вычисляются:

- доли компонент в RT;
- изменения вкладов по условиям;
- сегментарные профили перераспределения.

---

### 6.3 Архитектурные контрасты

Для сценариев A1 и B
формируются:

- Δ(ΔV5/MT − ΔV4);
- контрасты архитектур по условиям;
- устойчивость архитектурных различий.

---

### 6.4 Латерализационные и пространственные метрики

При наличии соответствующих осей
рассчитываются:

- различия по пространственной локализации;
- симметрия / асимметрия эффектов;
- позиционно-зависимые профили.

---

## 7. Формирование сценарных артефактов

Результатом C3.4 являются
**стандартизированные вычислительные артефакты**.

### 7.1 ScenarioResult

Основной артефакт сценария.

Содержит:
- идентификатор сценария;
- версию сценария;
- список использованных данных;
- рассчитанные метрики;
- QC-контекст.

---

### 7.2 DistributionPack

Артефакт распределений,
используемый для визуализации:

- компонент;
- контрастов;
- условных срезов.

---

### 7.3 ContrastPack

Артефакт сравнений,
содержащий:

- парные контрасты;
- сценарно допустимые сравнения;
- границы интерпретируемости.

---

## 8. Версионность и воспроизводимость

Каждый сценарный запуск
обязан фиксировать:

- версию сценария;
- версию ETL;
- версию расчёта компонент;
- версию QC;
- параметры запуска.

Никакие сценарные вычисления
**не выполняются «поверх старых результатов»**.

---

## 9. Принципиальные ограничения C3.4

Запрещено:

- выполнять вычисления без QC;
- смешивать данные разных сценариев;
- создавать неявные метрики;
- выполнять агрегирование вне C3.3;
- передавать в визуализацию «сырые» данные.

C3.4 является **единственным источником
интерпретируемых вычислительных артефактов**.

---

## 10. Связь с последующими уровнями

- **C3.5** визуализирует
  только артефакты C3.4;
- **C4** интерпретирует
  только результаты C3.4;
- пользовательский интерфейс
  не имеет права обходить C3.4.

---

## 11. Итоговая роль C3.4

Слой C3.4 обеспечивает:

- формальную реализацию сценариев A и B;
- воспроизводимость аналитических выводов;
- строгую границу между вычислением и интерпретацией;
- архитектурную целостность проекта v4.

C3.4 является
**ключевым вычислительным ядром**
NeuroTransAnalytics v4.

---
