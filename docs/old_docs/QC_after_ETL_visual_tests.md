QC_after_ETL_visual_tests.md
Логическая спецификация контроля качества данных после ETL
1. Назначение QC после ETL

QC (quality control) после ETL предназначен для:

проверки корректности переноса данных из boxbase в visual_tests;

выявления технических и методических аномалий;

фиксации ограничений интерпретации ещё до расчёта агрегатов.

QC не предназначен для:

очистки данных;

исправления значений;

исключения попыток;

статистической фильтрации.

QC — это этап валидации, а не обработки.

2. Место QC в архитектуре

Последовательность этапов:

boxbase
   ↓
ETL (логическое преобразование)
   ↓
visual_tests
   ↓
QC_after_ETL   ← (настоящий документ)
   ↓
aggregates / analysis_results


QC работает исключительно с visual_tests
и никогда напрямую с boxbase.

3. Объект QC

Единицей контроля качества является:

одна запись visual_tests
(один тест одного пациента в одной сессии).

QC не агрегирует данные между тестами и сессиями.

4. Уровни QC

QC после ETL состоит из четырёх логических уровней.

4.1. Структурный QC

Проверяется структурная целостность записи.

Обязательные условия:

присутствуют:

patient_id,

session_id,

test_type;

test_type ∈ {Tst1, Tst2, Tst3};

присутствует набор RT (rt_values);

присутствуют счётчики:

missed_count,

premature_count;

присутствует временной контекст тестирования.

Нарушения:

отсутствие обязательных полей;

некорректное значение test_type.

Действие:
запись помечается как структурно некорректная
и исключается из дальнейшего анализа.

4.2. Количественный QC

Проверяется числовая согласованность данных.

Проверки:

количество RT:

≤ 36;

≥ минимально допустимого для анализа;

missed_count ≥ 0;

premature_count ≥ 0;

сумма:

valid_RT_count + missed_count + premature_count


не противоречит структуре теста.

Важное ограничение:

точные позиции пропусков и преждевременных реакций неизвестны;

проверка носит оценочный, а не точный характер.

Действие:
при несоответствии — запись помечается как
ограниченно надёжная.

4.3. Физиологический QC (диапазоны)

Проверяется правдоподобие значений RT.

Проверки:

RT > 0;

RT не выходит за физиологически допустимые пределы;

отсутствие систематически одинаковых значений (артефакт регистрации).

⚠️ Важно:

QC не удаляет выбросы;

QC не применяет статистические критерии;

QC фиксирует факт аномалии, а не устраняет её.

Действие:
запись маркируется как
содержащая физиологически атипичные значения.

4.4. Контекстный QC (выполнение теста)

Используются счётчики ошибок выполнения.

Анализируется:

абсолютное число пропусков;

абсолютное число преждевременных реакций;

их доля относительно валидных RT.

Принцип:

счётчики не являются основанием для автоматического исключения;

они служат:

индикатором сложности выполнения,

модификатором доверия к агрегатам.

Действие:
фиксируется уровень надёжности выполнения теста.

5. Классификация статуса записи после QC

По результатам QC каждая запись visual_tests получает один из статусов:

QC_OK

структурно корректна;

количественно согласована;

без критических аномалий.

QC_LIMITED

данные корректны;

интерпретация требует осторожности
(много пропусков, высокая вариабельность и т. п.).

QC_INVALID

структурные ошибки;

грубые несоответствия;

использование в анализе невозможно.

⚠️ Статус QC не изменяет данные,
а только описывает их качество.

6. Что QC принципиально НЕ делает

QC после ETL:

не реконструирует историю повторов;

не пытается угадать причины пропусков;

не корректирует RT;

не пересчитывает счётчики;

не принимает диагностических решений.

QC — граница ответственности, а не аналитический этап.

7. Связь QC с последующими этапами

агрегаты рассчитываются только для записей с QC_OK и QC_LIMITED;

статус QC обязан учитываться при интерпретации результатов;

QC_INVALID не используется в анализе, но сохраняется в базе.

8. Статус документа

Настоящий документ является:

нормативной логической спецификацией QC после ETL;

обязательным промежуточным этапом перед любым анализом;

независимым от конкретной реализации.

Изменения допускаются только при:

изменении структуры visual_tests;

изменении протокола тестирования;

появлении новых регистрируемых параметров.

Контрольная фиксация

После утверждения данного документа:

слой ETL + QC считается методически закрытым;

все последующие аналитические шаги
опираются на уже валидированные данные.