Aggregates_extended_after_QC.md
Расширенные агрегаты: латерализация, канальные группы, пороговые показатели
1. Назначение документа

Документ описывает расширенный набор агрегатов, рассчитываемых:

только после ETL и QC;

поверх минимальных агрегатов, не заменяя их;

без изменения исходных данных.

Расширенные агрегаты предназначены для:

более детального внутриличностного анализа;

сопоставления условий тестирования;

подготовки данных к лонгитюдинному анализу.

2. Принципиальные ограничения (наследуются без изменений)

Расширенные агрегаты:

рассчитываются только для записей со статусом QC_OK или QC_LIMITED;

используют только финальные RT из visual_tests;

не реконструируют пропуски и повторы;

не вводят физиологических интерпретаций.

Все интерпретации носят аналитический, а не диагностический характер.

3. Расширение №1: латерализационные агрегаты
3.1. Основание для латерализации

Латерализация определяется не из данных visual_tests, а через:

порядок RT в rt_values[],

соответствие номеров попыток зонам поля зрения,

таблицы метаданных теста.

Допустимые зоны:

Left

Center

Right

3.2. Объект латерализационного агрегирования

Единица расчёта:

подмножество rt_values[],
соответствующее одной зоне поля зрения
в рамках одного теста.

3.3. Набор латерализационных агрегатов

Для каждой зоны (Left, Center, Right) рассчитываются:

median_rt_zone

mad_rt_zone

valid_rt_count_zone

Ограничения:

если число валидных RT в зоне недостаточно,
агрегат рассчитывается, но маркируется как ограниченно надёжный;

зоны не сравниваются напрямую без учёта контекста теста.

4. Расширение №2: агрегаты по канальным группам
4.1. Принцип канальной группировки

Канальные группы вводятся как аналитические ярлыки, основанные на типе теста:

test_type	Канальная группа
Tst1	P (parvo-oriented)
Tst2	P/K (color-modulated)
Tst3	M (motion-oriented)

⚠️ Это не изоляция физиологических каналов, а функциональная классификация условий.

4.2. Объект агрегирования

Единица:

все RT одного теста
(или соответствующей латерализационной подгруппы).

4.3. Набор канальных агрегатов

Рассчитываются те же показатели, что и в минимальном наборе:

median_rt_channel

mad_rt_channel

valid_rt_count_channel

missed_count

premature_count

Канальные агрегаты наследуют QC-статус исходной записи visual_tests.

5. Расширение №3: пороговые показатели
5.1. Назначение порогов

Пороговые показатели используются для:

описания «хвостов» распределения RT;

выявления условий с повышенной долей замедленных реакций;

контекстной оценки устойчивости выполнения теста.

Пороги не являются диагностическими.

5.2. Источник порогов

Пороговые значения:

задаются явно;

фиксируются в параметрах анализа;

не выводятся автоматически из данных.

Примеры:

600 мс

800 мс

индивидуальные относительные пороги (по медиане)

5.3. Набор пороговых агрегатов

Для каждого теста (и при необходимости — для зоны или канальной группы):

count_rt_above_threshold

share_rt_above_threshold

count_rt_below_threshold (при необходимости)

Ограничения:

пороговые показатели не заменяют медиану и MAD;

интерпретируются только совместно с ними.

6. Комбинированные агрегаты (ограниченно)

Допускается комбинация расширений:

латерализация × порог;

канальная группа × порог.

❌ Не допускается:

построение сложных индексов;

объединение нескольких тестов в один агрегат на уровне агрегирования.

✔️ Сопоставление, разностный и контрастный анализ результатов разных тестов
выполняется на отдельном уровне сравнительного (relational) анализа,
поверх агрегатов, без их смешения.

7. Правила интерпретации расширенных агрегатов

При интерпретации необходимо:

рассматривать расширенные агрегаты в контексте минимальных;

учитывать QC-статус и счётчики пропусков;

избегать абсолютных межиндивидуальных сравнений;

формулировать выводы в терминах направленности изменений.

8. Хранение результатов

Результаты расширенных агрегатов:

сохраняются в аналитическом слое (analysis_results);

связаны с:

patient_id,

session_id,

test_type,

типом агрегата;

не перезаписывают минимальные агрегаты.

9. Статус документа

Документ является:

расширением базовой агрегатной спецификации;

необязательным для минимального анализа;

обязательным для всех расширенных интерпретаций.

Изменения допускаются только при:

изменении метаданных теста;

добавлении новых тестов;

изменении логики QC.